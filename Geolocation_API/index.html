<!DOCTYPE html>
<head>
<title>Geolocation API</title>
<script type="text/javascript"
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>
<body>
<a href="http://www.w3.org/html/logo/" style="right:5px;top:5px;position:absolute">
<img src="http://www.w3.org/html/logo/badge/html5-badge-h-device.png" width="133" height="64" alt="HTML5 Powered with Device Access" title="HTML5 Powered with Device Access">
</a>
<div id="map_canvas"
	style="width: 400px; height: 300px; margin-bottom: 10px;"></div>
<div id="msg" style="margin-top: 10px;"></div>

<script type="text/javascript"
	src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript">
	// checks if the geolocation api is available
	if (typeof navigator.geolocation !== 'undefined') {
		//initialize some variable
		var map;
		var infowindow = new google.maps.InfoWindow();
		var geocoder;
		/* - initialize the google maps api with jQuery dom.ready
		 * - initailize the map with the FHS buildung as
		 *   default location
		 **/
		$(document)
				.ready(
						function() {
							// initialize the gecoder to get later the address of the useres location
							geocoder = new google.maps.Geocoder();

							// the default/ starting point of the map
							var latlng = new google.maps.LatLng(50.715313,
									10.467457);

							// some special options for the map
							var myOptions = {
								zoom : 18,
								center : latlng,
								mapTypeId : google.maps.MapTypeId.SATELLITE
							};

							// creating the map
							map = new google.maps.Map(document
									.getElementById("map_canvas"), myOptions);

							//adding the button to search for the location
							$('#map_canvas')
									.after(
											'<form style="text-align:center;width:400px;"><input type="button" id="searchButton" value="Show me where i am!" onclick="findMe();"></form>');

						});

		/*
		 *	will be called when somebody clicks on the button
		 *  
		 **/
		function findMe() {
			// defining the success callback function
			var successCallback = function(position) {
				// get the latitude and longitude from the geolocation api
				var myLatitude = position.coords.latitude;
				var myLongitude = position.coords.longitude;

				/* creating a new point with the location data 
				 * of the user and set it to the map
				 **/
				var newPoint = new google.maps.LatLng(myLatitude, myLongitude)
				map.setCenter(newPoint, 15);

				// Needed to add the address in an infoWindow
				if (geocoder) {
					geocoder
							.geocode(
									{
										'latLng' : newPoint
									},
									function(results, status) {
										if (status == google.maps.GeocoderStatus.OK) {
											if (results[1]) {
												map.setZoom(15);
												// creating a marker for the location
												marker = new google.maps.Marker(
														{
															position : newPoint,
															map : map
														});

												// insert the address data
												infowindow
														.setContent(results[0].formatted_address);
												infowindow.open(map, marker);
											}
										} else {
											alert("Geocoder failed due to: "
													+ status);
										}
									});
				}

				// show all informations that have been collected by the browser
				console.log(position);
				
				var msg = 'These are all the information your browser makes available:<hr>'
						+ 'Timestamp: '
						+ position.timestamp
						+ '<br>'
						+ 'latitude: '
						+ position.coords.latitude
						+ '<br>'
						+ 'longitude: '
						+ position.coords.longitude
						+ '<br>'
						+ 'altitude: '
						+ position.coords.altitude
						+ '<br>'
						+ 'accuracy: '
						+ position.coords.accuracy
						+ '<br>'
						+ 'altitude accuracy: '
						+ position.coords.altitudeAccuracy
						+ '<br>'
						+ 'heading: '
						+ position.coords.heading
						+ '<br>'
						+ 'speed : ' + position.coords.speed + '<br>'
						+ '<br><hr>'
						+ 'How does firefox (or an other browser) knows where you are?<br>'
						+ 'This is called "Google Location Services".<br>'
						+ 'More information here:<br>'
						+ '<a title="more informations about the geolocation API from firefox" href="http://www.mozilla.com/en/firefox/geolocation/">http://www.mozilla.com/en/firefox/geolocation/</a>';

				$('#msg').html(msg);
			};
			// defining the error callback
			var errorCallback = function(error) {
				switch (error.code) {
				case error.TIMEOUT:
					alert('The Google Location Service does not answer, sorry. Timeout!');
					break;
				case error.POSITION_UNAVAILABLE:
					alert('Position unavailable');
					break;
				case error.PERMISSION_DENIED:
					alert('Permission denied');
					break;
				case error.UNKNOWN_ERROR:
					alert('Unknown error');
					break;
				}
			};
			// defining some options for the geo api
			var options = {
				enableHighAccuracy : true, // super accuracy
				timeout : 2000, // maximum waiting time
				maximumAge : 0	// maximum acceptable cache age
			};

			// call the geolocation api
			navigator.geolocation.getCurrentPosition(successCallback,
					errorCallback, options);
			/* How does firefox (or an other browser) knows where you are?
			 * Its called "Google Location Services".
			 * More information here:
			 * http://www.mozilla.com/en/firefox/geolocation/
			 **/

		}
	} else {
		// is shown if the browser doesn't support the geolocation api
		$('#map_canvas')
				.html(
						'<h3>Sorry, but your browser does not support the Geolocation API of HTML5!</h3>');
	}
</script>
</body>
</html>